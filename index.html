<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ali Ghanbari - Resume</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Vazirmatn:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --divar-red: #A62626;
            --text-dark: #1f2937;
            --text-medium: #4b5563;
            --bg-light: #f9fafb;
            --bg-soft-gray: #f3f4f6;
            /* Gemini Gradient */
            --gemini-grad-from: #4285F4;
            --gemini-grad-via: #9B59B6;
            --gemini-grad-to: #D94A8C;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-soft-gray);
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23d1d5db' fill-opacity='0.4' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
        }
        .persian-header {
            font-family: 'Vazirmatn', sans-serif;
        }
        .section-title-container {
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 2px solid #e5e7eb;
        }
        .section-title-icon {
            color: var(--divar-red);
            background-color: #fee2e2;
            border-radius: 9999px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .section-title {
            color: var(--text-dark);
        }
        .text-justify {
            text-align: justify;
        }
        ul li {
            text-align: left;
        }
        .info-card {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-left: 4px solid var(--divar-red);
            transition: all 0.3s ease;
        }
        .info-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        #ai-modal-backdrop, #ai-modal {
            transition: opacity 0.3s ease-in-out;
        }
        #ai-modal {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        
        .gemini-btn {
            background-image: linear-gradient(to right, var(--gemini-grad-from), var(--gemini-grad-via), var(--gemini-grad-to));
            background-size: 200% auto;
            transition: background-position 0.5s;
        }
        .gemini-btn:hover {
            background-position: right center;
        }

        .tooltip-container {
            position: relative;
            display: inline-flex;
            align-items: center;
        }
        .tooltip-text {
            visibility: hidden;
            width: 240px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 51;
            bottom: 125%;
            left: 50%;
            margin-left: -120px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            font-weight: normal;
        }
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        @media screen {
            .only-print { display: none; }
        }
        @media print {
            body {
                background-image: none !important;
                background-color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .print-container, .info-card, .section-title-icon, .bg-white, .border-\[\--divar-red\] {
                box-shadow: none !important;
                border: 1px solid #e5e7eb;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .no-print { display: none !important; }
            .only-print { display: inline-flex !important; }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <p class="persian-header text-center text-gray-500 mb-4 text-lg no-print">بسم هو</p>
        <div class="bg-white shadow-2xl rounded-lg p-8 md:p-12 print-container">

            <!-- Header Section -->
            <header class="flex flex-col md:flex-row items-center justify-between mb-12 pb-8 border-b-2 border-gray-100">
                <div class="text-center md:text-left">
                    <h1 class="text-4xl md:text-5xl font-bold text-gray-800 tracking-tight">Ali Ghanbari</h1>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2 text-gray-600 text-md">
                        <span class="flex items-center justify-center md:justify-start"><i class="fas fa-map-marker-alt mr-2 text-gray-400"></i>Tehran, Iran</span>
                        <a href="tel:+989397860366" class="flex items-center justify-center md:justify-end text-gray-600 hover:text-[var(--divar-red)] transition-colors"><i class="fas fa-phone mr-2 text-gray-400"></i>+98 939 786 0366</a>
                        <a href="mailto:MrAli1211@outlook.com" class="flex items-center justify-center md:justify-start text-gray-600 hover:text-[var(--divar-red)] transition-colors"><i class="fas fa-envelope mr-2 text-gray-400"></i>MrAli1211@outlook.com</a>
                        <a href="https://linkedin.com/in/Ali-Ghanbari10" target="_blank" class="flex items-center justify-center md:justify-end text-gray-600 hover:text-[var(--divar-red)] transition-colors"><i class="fab fa-linkedin mr-2 text-gray-400"></i>Ali-Ghanbari10</a>
                    </div>
                </div>
                <!-- User requested src to be empty -->
                <img src="" alt="Photo of Ali Ghanbari" class="w-36 h-36 rounded-3xl object-cover border-4 border-[var(--divar-red)] shadow-lg mt-6 md:mt-0 bg-gray-200">
            </header>

            <!-- Summary Section -->
            <section class="mb-10">
                <div class="section-title-container flex items-center gap-3 pb-2 mb-4">
                    <div class="section-title-icon rounded-full w-9 h-9 flex items-center justify-center flex-shrink-0"><i class="fas fa-user-tie"></i></div>
                    <h2 class="text-2xl font-bold uppercase section-title">Summary</h2>
                    <div class="ml-auto flex items-center space-x-2 flex-shrink-0">
                         <div class="tooltip-container no-print">
                            <i class="fas fa-info-circle text-gray-400 hover:text-gray-600 cursor-pointer text-lg transition-colors"></i>
                            <span class="tooltip-text">This AI feature rewrites Ali Ghanbari's summary and highlights his most relevant experiences/skills based on a provided job title.</span>
                        </div>
                        <button id="ai-summary-btn" class="no-print gemini-btn text-white font-bold py-2 px-3 rounded-lg flex items-center">
                            <i class="fas fa-wand-magic-sparkles mr-2"></i> Tailor Resume with AI
                        </button>
                         <a id="ai-summary-link" href="#" target="_blank" class="only-print bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-3 rounded-lg items-center">
                            <i class="fas fa-external-link-alt mr-2"></i> View Interactive Version
                        </a>
                        <button id="reset-btn" class="no-print bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-3 rounded-lg flex items-center hidden">
                            <i class="fas fa-undo mr-2"></i> Reset
                        </button>
                    </div>
                </div>
                <p id="summary-text" class="text-gray-700 leading-relaxed text-justify">
                    As Executive Director, I took on the responsibility of reviving a student publication in crisis. To achieve this, we formed a 20-person team after conversations with over 100 students. Through teamwork, we shifted the publication's strategy from print to audio, launched the university's first podcast, and by organizing multiple events, transformed its identity into a media platform focused on student growth. Concurrently, I taught myself and implemented analytical tools at a fintech startup and participated in business negotiations. I am seeking an opportunity to apply this action-oriented spirit and teamwork experience to solve real-world business challenges and contribute to product growth.
                </p>
            </section>

            <!-- Experience Section -->
            <section id="experience-section" class="mb-10">
                <div class="section-title-container pb-2 mb-4">
                    <div class="section-title-icon rounded-full w-9 h-9 flex items-center justify-center"><i class="fas fa-briefcase"></i></div>
                    <h2 class="text-2xl font-bold uppercase section-title">Experience</h2>
                </div>
                
                <div class="mb-8" data-job-id="mentor">
                    <h3 class="text-xl font-bold text-gray-800">Team Mentor</h3>
                    <p class="text-md text-gray-600 italic mt-1">New Samaneh, IUST (Student Organization) | Sep 2023 – Present</p>
                    <ul class="mt-4 list-disc list-inside text-gray-700 space-y-2">
                        <li data-id="exp-mentor-1">Supported members in growing toward future team; continued informal mentoring afterward.</li>
                        <li data-id="exp-mentor-2">Still mentor team in events like 'Exir Job Expo' and 'From Konkor to Job' (with guests like Amin Aramesh and Mohammad Hadi Shirani).</li>
                    </ul>
                </div>
                
                <div class="mb-8" data-job-id="director">
                    <h3 class="text-xl font-bold text-gray-800">Executive Director</h3>
                    <p class="text-md text-gray-600 italic mt-1">New Samaneh, IUST (Student Organization) | May 2022 – Sep 2023</p>
                    <ul class="mt-4 list-disc list-inside text-gray-700 space-y-2">
                        <li data-id="exp-director-1">Rebuilt and led a student Magazine from zero, growing it into an active community with multiple departments with more than 20 active members.</li>
                        <li data-id="exp-director-2">Founded 'NoPa' podcast and producing over 22 episodes and more than 4000 times listened (organic growth), organized key events, including 'A bridge to the future'.</li>
                        <li data-id="exp-director-3">Worked with Tapsell to provide free training access and invited their CMO to join an on-campus panel.</li>
                        <li data-id="exp-director-4">Played a supporting role in creating a shared team culture and longer-term commitment.</li>
                    </ul>
                </div>

                <div data-job-id="associate">
                    <h3 class="text-xl font-bold text-gray-800">Marketing & Business Development Associate</h3>
                    <p class="text-md text-gray-600 italic mt-1">Nasiba (Lendtech / BNPL) | Oct 2022 – Nov 2023</p>
                    <ul class="mt-4 list-disc list-inside text-gray-700 space-y-2">
                        <li data-id="exp-associate-1">Taught myself GA4 & GTM; used them to help the team make sense of key metrics.</li>
                        <li data-id="exp-associate-2">Initiated and executed SMS campaigns and basic content production.</li>
                        <li data-id="exp-associate-3">Joined business team to talk to merchants and support outreach.</li>
                        <li data-id="exp-associate-4">Represented Nasiba in Iran Fintech Association.</li>
                        <li data-id="exp-associate-5">Brought in three interns via university network; facilitated external collaborations.</li>
                    </ul>
                </div>
            </section>

            <!-- Education Section -->
            <section id="education-section" class="mb-10">
                <div class="section-title-container pb-2 mb-4">
                    <div class="section-title-icon rounded-full w-9 h-9 flex items-center justify-center"><i class="fas fa-graduation-cap"></i></div>
                    <h2 class="text-2xl font-bold uppercase section-title">Education</h2>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-gray-800">B.Sc. in Industrial Engineering</h3>
                    <p class="text-md text-gray-600 italic">Iran University of Science and Technology | 2021 – Present (Expected Graduation: 2026)</p>
                </div>
            </section>

            <!-- Skills Section -->
            <section id="skills-section" class="mb-10">
                <div class="section-title-container pb-2 mb-4">
                    <div class="section-title-icon rounded-full w-9 h-9 flex items-center justify-center"><i class="fas fa-cogs"></i></div>
                    <h2 class="text-2xl font-bold uppercase section-title">Skills</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 text-gray-700">
                    <div>
                        <h4 class="font-bold text-lg mb-2 text-gray-800">Communication & Collaboration</h4>
                        <ul class="list-disc list-inside space-y-1">
                            <li data-id="skill-comm-1">Working Across Functional Roles</li>
                            <li data-id="skill-comm-2">Negotiation & Partnership Management</li>
                            <li data-id="skill-comm-3">Public Speaking and Group Facilitation</li>
                            <li data-id="skill-comm-4">Storytelling & Internal Motivation</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg mb-2 text-gray-800">Leadership & People Development</h4>
                        <ul class="list-disc list-inside space-y-1">
                            <li data-id="skill-lead-1">Team Building from Scratch</li>
                            <li data-id="skill-lead-2">Talent Identification & Mentorship</li>
                            <li data-id="skill-lead-3">Facilitating Group Progress in Uncertain Situations</li>
                            <li data-id="skill-lead-4">Listening and Conflict Navigation</li>
                            <li data-id="skill-lead-5">Creating Shared Sense of Ownership</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <!-- Additional Information Section -->
            <section id="additional-info-section">
                <div class="section-title-container pb-2 mb-4">
                       <div class="section-title-icon rounded-full w-9 h-9 flex items-center justify-center"><i class="fas fa-info-circle"></i></div>
                    <h2 class="text-2xl font-bold uppercase section-title">Additional Information</h2>
                </div>
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">
                    <div class="p-6 rounded-lg info-card">
                        <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center"><i class="fas fa-tools mr-3 text-[var(--divar-red)]"></i>Technical Tools</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1 pl-2">
                            <li data-id="skill-tech-1">GA4 & GTM</li>
                            <li data-id="skill-tech-2">Leveraging AI tools for efficiency</li>
                            <li data-id="skill-tech-3">Trello</li>
                            <li data-id="skill-tech-4">Excel (PivotTables, Lookups) & Power BI</li>
                            <li data-id="skill-tech-5">Microsoft Office, Canva</li>
                        </ul>
                    </div>
                    <div class="p-6 rounded-lg info-card">
                        <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center"><i class="fas fa-certificate mr-3 text-[var(--divar-red)]"></i>Certificates</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1 pl-2">
                            <li><a href="https://college.tapsell.ir/certificate/54765/" target="_blank" class="hover:text-[var(--divar-red)] underline">Google Analytics 4</a> – Tapsell, 2023</li>
                            <li><a href="https://coursera.org/verify/EE2GH5AQCB2H" target="_blank" class="hover:text-[var(--divar-red)] underline">Digital Marketing & E-commerce</a> – Google, 2023</li>
                        </ul>
                    </div>
                    <div class="p-6 rounded-lg info-card">
                        <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center"><i class="fas fa-language mr-3 text-[var(--divar-red)]"></i>Languages</h3>
                         <ul class="list-disc list-inside text-gray-700 space-y-1 pl-2">
                            <li>Farsi: Native</li>
                            <li>English: Upper Intermediate</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- AI Modal -->
    <div id="ai-modal-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden opacity-0"></div>
    <div id="ai-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden opacity-0 transform scale-95">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800 flex items-center">
                    <span class="w-6 h-6 mr-3 rounded-full gemini-btn"></span>
                    Tailor Resume
                </h3>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <p class="text-gray-600 mb-4">Enter the target job title. The AI will rewrite the summary and highlight the most relevant experiences and skills.</p>
            <input type="text" id="job-title-input" placeholder="e.g., Business Development Intern" class="w-full p-2 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-[var(--gemini-grad-from)] focus:border-transparent">
            <button id="generate-btn" class="w-full gemini-btn text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center">
                <span id="generate-btn-text">Generate</span>
                <svg id="loading-spinner" class="animate-spin h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </button>
            <p id="error-message" class="text-red-500 text-sm mt-2 text-center"></p>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const LIVE_RESUME_URL = "https://ali-ghanbari-resume.vercel.app/"; 
        document.getElementById('ai-summary-link').href = `${LIVE_RESUME_URL}?tailor=true`;

        // --- Store Original State ---
        const originalState = {
            summary: document.getElementById('summary-text').innerHTML,
            experience: document.getElementById('experience-section').innerHTML,
            skills: document.getElementById('skills-section').innerHTML,
        };

        // --- Modal & Reset Logic ---
        const aiModalBackdrop = document.getElementById('ai-modal-backdrop');
        const aiModal = document.getElementById('ai-modal');
        const aiSummaryBtn = document.getElementById('ai-summary-btn');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const resetBtn = document.getElementById('reset-btn');

        const openModal = () => {
            aiModalBackdrop.classList.remove('hidden');
            aiModal.classList.remove('hidden');
            setTimeout(() => {
                aiModalBackdrop.classList.remove('opacity-0');
                aiModal.classList.remove('opacity-0', 'scale-95');
            }, 10);
        };

        const closeModal = () => {
            aiModalBackdrop.classList.add('opacity-0');
            aiModal.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                aiModalBackdrop.classList.add('hidden');
                aiModal.classList.add('hidden');
                document.getElementById('error-message').textContent = '';
            }, 300);
        };

        aiSummaryBtn.addEventListener('click', openModal);
        closeModalBtn.addEventListener('click', closeModal);
        aiModalBackdrop.addEventListener('click', closeModal);
        
        const resetResume = () => {
            document.getElementById('summary-text').innerHTML = originalState.summary;
            document.getElementById('experience-section').innerHTML = originalState.experience;
            document.getElementById('skills-section').innerHTML = originalState.skills;
            resetBtn.classList.add('hidden');
            const aiButtonContainer = aiSummaryBtn.parentElement;
            if(aiButtonContainer) aiButtonContainer.style.display = 'flex';
        };
        resetBtn.addEventListener('click', resetResume);

        // --- Gemini API Logic (UNCHANGED as requested) ---
        const generateBtn = document.getElementById('generate-btn');
        const jobTitleInput = document.getElementById('job-title-input');
        
        const getApiKey = async () => {
            try {
                const response = await fetch('/api/key');
                if (!response.ok) throw new Error('Could not fetch API key from server');
                const data = await response.json();
                return data.apiKey;
            } catch (error) {
                console.error('Error fetching API key:', error);
                document.getElementById('error-message').textContent = "Error: Could not connect to the API server.";
                return null;
            }
        };

        const callGeminiApi = async (prompt, retries = 3, delay = 1000) => {
            const apiKey = await getApiKey();
            if (!apiKey) {
                 throw new Error("API Key not available. Ensure it's set in Vercel Environment Variables.");
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            const payload = { 
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                  responseMimeType: "application/json",
                  responseSchema: {
                        type: "OBJECT",
                        properties: {
                            summary: { type: "STRING" },
                            relevant_experience_ids: {
                                type: "ARRAY",
                                items: { type: "STRING" }
                            },
                            relevant_skill_ids: {
                                type: "ARRAY",
                                items: { type: "STRING" }
                            }
                        }
                    }
                }
            };

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    
                    if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        return JSON.parse(result.candidates[0].content.parts[0].text);
                    } else {
                        console.error("Unexpected API response:", result);
                        throw new Error("Invalid response structure from API.");
                    }
                } catch (error) {
                    if (i === retries - 1) {
                        console.error("API call failed after multiple retries:", error);
                        throw error;
                    }
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
        };

        const tailorResume = async () => {
            const jobTitle = jobTitleInput.value.trim();
            if (!jobTitle) {
                document.getElementById('error-message').textContent = "Please enter a job title.";
                return;
            }

            const generateBtnText = document.getElementById('generate-btn-text');
            const loadingSpinner = document.getElementById('loading-spinner');
            const errorMessage = document.getElementById('error-message');

            generateBtnText.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            generateBtn.disabled = true;
            errorMessage.textContent = '';

            try {
                let experienceForPrompt = '';
                document.querySelectorAll('#experience-section ul li').forEach(li => {
                    experienceForPrompt += `[id: ${li.dataset.id}] ${li.textContent.trim()}\n`;
                });

                let skillsForPrompt = '';
                 document.querySelectorAll('#skills-section ul li').forEach(li => {
                    skillsForPrompt += `[id: ${li.dataset.id}] ${li.textContent.trim()}\n`;
                });

                const prompt = `
                    Analyze the following resume content and tailor it for the job title: "${jobTitle}".
                    
                    **Tone of Voice Instructions:** The user's core values are teamwork and authenticity. The generated text must reflect this. Use a humble yet confident, action-oriented, and team-focused tone ("we" for team achievements). Avoid buzzwords, exaggeration, or language that sounds like a "lone star". The summary should be grounded in the provided facts.

                    1.  **Rewrite the Summary:** Create a professional summary (3-4 sentences) that highlights the most relevant aspects for this specific role, while adhering to the specified tone.
                    2.  **Select Relevant Experiences:** From the list of experiences below, identify the IDs of the bullet points that are most relevant to the job title. Return only the IDs.
                    3.  **Select Relevant Skills:** From the list of skills below, identify the IDs of the skills that are most relevant. Return only the IDs.
                    
                    **Experiences:**
                    ${experienceForPrompt}

                    **Skills:**
                    ${skillsForPrompt}

                    Return a JSON object with three keys: "summary", "relevant_experience_ids", and "relevant_skill_ids".
                `;

                const tailoredContent = await callGeminiApi(prompt);
                
                // Update Summary
                document.getElementById('summary-text').innerHTML = `<p class="text-gray-700 dark:text-gray-300 leading-relaxed text-justify">${tailoredContent.summary}</p>`;

                // Update Experience
                const allExpItems = document.querySelectorAll('#experience-section ul li');
                allExpItems.forEach(li => li.classList.add('hidden'));
                if (tailoredContent.relevant_experience_ids && tailoredContent.relevant_experience_ids.length > 0) {
                    tailoredContent.relevant_experience_ids.forEach(id => {
                        const el = document.querySelector(`li[data-id="${id}"]`);
                        if(el) el.classList.remove('hidden');
                    });
                }
                
                // Update Skills
                const allSkillItems = document.querySelectorAll('#skills-section ul li');
                allSkillItems.forEach(li => li.classList.add('hidden'));
                 if (tailoredContent.relevant_skill_ids && tailoredContent.relevant_skill_ids.length > 0) {
                    tailoredContent.relevant_skill_ids.forEach(id => {
                        const el = document.querySelector(`li[data-id="${id}"]`);
                        if(el) el.classList.remove('hidden');
                    });
                }
                
                resetBtn.classList.remove('hidden');
                const aiButtonContainer = aiSummaryBtn.parentElement;
                if(aiButtonContainer) aiButtonContainer.style.display = 'none';
                closeModal();

            } catch (error) {
                errorMessage.textContent = "Failed to generate content. Please try again.";
                console.error("Full error:", error);
            } finally {
                generateBtnText.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
                generateBtn.disabled = false;
            }
        };

        generateBtn.addEventListener('click', tailorResume);
        jobTitleInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                tailorResume();
            }
        });

        // Auto-open modal if URL parameter is present
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('tailor')) {
                openModal();
            }
        });
    </script>
</body>
</html>
